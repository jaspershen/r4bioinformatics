<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 13 多组学分析 | R for Bioinformatics project</title>
<meta name="author" content="Xiaotao Shen">
<meta name="description" content="13.1 WGCNA 使用官方例子进行学习. https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/Tutorials/  13.2 基础概念 参考这篇文章....">
<meta name="generator" content="bookdown 0.37 with bs4_book()">
<meta property="og:title" content="Chapter 13 多组学分析 | R for Bioinformatics project">
<meta property="og:type" content="book">
<meta property="og:url" content="https://jaspershen.github.io/r4bioinformatics/multiomics.html">
<meta property="og:image" content="https://jaspershen.github.io/r4bioinformatics/cover.png">
<meta property="og:description" content="13.1 WGCNA 使用官方例子进行学习. https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/Tutorials/  13.2 基础概念 参考这篇文章....">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 13 多组学分析 | R for Bioinformatics project">
<meta name="twitter:description" content="13.1 WGCNA 使用官方例子进行学习. https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/Tutorials/  13.2 基础概念 参考这篇文章....">
<meta name="twitter:image" content="https://jaspershen.github.io/r4bioinformatics/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Poppins-0.4.8/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.6.1/transition.js"></script><script src="libs/bs3compat-0.6.1/tabs.js"></script><script src="libs/bs3compat-0.6.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.2.1/leaflet.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.31/datatables.js"></script><link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R for Bioinformatics project</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Preface</a></li>
<li class="book-part">Project organization</li>
<li><a class="" href="r4bioinformatics.html"><span class="header-section-number">2</span> R for Bioinformatics analysis</a></li>
<li class="book-part">Markdown</li>
<li><a class="" href="markdown.html"><span class="header-section-number">3</span> Markdown</a></li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">4</span> Rmarkdown</a></li>
<li><a class="" href="rmarkdown_beyond.html"><span class="header-section-number">5</span> Rmarkdown拓展</a></li>
<li class="book-part">Git</li>
<li><a class="" href="git.html"><span class="header-section-number">6</span> Git和github</a></li>
<li><a class="" href="git_teamwork.html"><span class="header-section-number">7</span> github team work</a></li>
<li class="book-part">Data visulization</li>
<li><a class="" href="ggplot2.html"><span class="header-section-number">8</span> ggplot2</a></li>
<li><a class="" href="network.html"><span class="header-section-number">9</span> Network分析总结</a></li>
<li><a class="" href="tidyverse_stringr.html"><span class="header-section-number">10</span> Tidyverse用于数据分析stringr</a></li>
<li><a class="" href="tidyverse_purrr.html"><span class="header-section-number">11</span> 功能化函数编程purrr</a></li>
<li><a class="" href="regularexpression.html"><span class="header-section-number">12</span> 正则表达式</a></li>
<li class="book-part">Bioinformatics</li>
<li><a class="active" href="multiomics.html"><span class="header-section-number">13</span> 多组学分析</a></li>
<li><a class="" href="biostatistics.html"><span class="header-section-number">14</span> Modern Statistics for Modern Biology</a></li>
<li><a class="" href="blogdown.html"><span class="header-section-number">15</span> Blogdown</a></li>
<li><a class="" href="bookdown.html"><span class="header-section-number">16</span> Bookdown</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/jaspershen/r4bioinformatics">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="multiomics" class="section level1" number="13">
<h1>
<span class="header-section-number">13</span> 多组学分析<a class="anchor" aria-label="anchor" href="#multiomics"><i class="fas fa-link"></i></a>
</h1>
<div id="wgcna" class="section level2" number="13.1">
<h2>
<span class="header-section-number">13.1</span> WGCNA<a class="anchor" aria-label="anchor" href="#wgcna"><i class="fas fa-link"></i></a>
</h2>
<p>使用官方例子进行学习.</p>
<p><a href="https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/Tutorials/" class="uri">https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/Tutorials/</a></p>
</div>
<div id="基础概念" class="section level2" number="13.2">
<h2>
<span class="header-section-number">13.2</span> 基础概念<a class="anchor" aria-label="anchor" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><i class="fas fa-link"></i></a>
</h2>
<p>参考这篇文章.</p>
<p><a href="https://www.omicshare.com/class/Public/Upload/video/20170607150629336688.pdf" class="uri">https://www.omicshare.com/class/Public/Upload/video/20170607150629336688.pdf</a></p>
<div id="无尺度网络scale-free-network" class="section level3" number="13.2.1">
<h3>
<span class="header-section-number">13.2.1</span> 无尺度网络(scale free network)<a class="anchor" aria-label="anchor" href="#%E6%97%A0%E5%B0%BA%E5%BA%A6%E7%BD%91%E7%BB%9Cscale-free-network"><i class="fas fa-link"></i></a>
</h3>
<p>基因符合无尺度分布</p>
<p>无尺度网络是指大部分节点的degree(与其相连的node)非常少,而小部分的node与非常多的节点相连.如果使用数学语言进行描述:假设某个基因(node)的degree为m,统计网络中所有的基因的m值,然后以m值大小对基因进行分类,n为基因连接数为m的基因,那么m和n成反比.</p>
</div>
<div id="模块module和模块特征值" class="section level3" number="13.2.2">
<h3>
<span class="header-section-number">13.2.2</span> 模块(module)和模块特征值<a class="anchor" aria-label="anchor" href="#%E6%A8%A1%E5%9D%97module%E5%92%8C%E6%A8%A1%E5%9D%97%E7%89%B9%E5%BE%81%E5%80%BC"><i class="fas fa-link"></i></a>
</h3>
<p>模块是指表达模式相似的一组基因.</p>
<p>模块特征值:将一组基因归为一个模块之后,如果我们想对该模块进行定量化表示,就需要使用一个值来进行表示该模块在所有样品中的表达值.这时候一般是使用该模块中的所有基因进行PCA分析,然后使用PC1(主成分1)来表示.</p>
</div>
<div id="连通性-connectivity" class="section level3" number="13.2.3">
<h3>
<span class="header-section-number">13.2.3</span> 连通性 (Connectivity)<a class="anchor" aria-label="anchor" href="#%E8%BF%9E%E9%80%9A%E6%80%A7-connectivity"><i class="fas fa-link"></i></a>
</h3>
<p>一个基因和其他所有基因的连接程度,一般只在模块内计算,称之为连接度(connectivity)或者degree.对于非权重网络来说,因为edge没有权重,因此有边就是1,没有边就是0,因此degree就是该基因的边的个数.对于权重网络,边是有权重的,因此,每个基因的degree是值所有边的权重之和.</p>
</div>
<div id="hub-gene" class="section level3" number="13.2.4">
<h3>
<span class="header-section-number">13.2.4</span> Hub gene<a class="anchor" aria-label="anchor" href="#hub-gene"><i class="fas fa-link"></i></a>
</h3>
<p>在一个模块中,degree排名靠前的基因,说明其处于枢纽位置,称之为hug gene.</p>
</div>
</div>
<div id="wgcna-介绍" class="section level2" number="13.3">
<h2>
<span class="header-section-number">13.3</span> WGCNA 介绍<a class="anchor" aria-label="anchor" href="#wgcna-%E4%BB%8B%E7%BB%8D"><i class="fas fa-link"></i></a>
</h2>
<p>全称为<code>weighted gene co-expression network analysis</code>.将研究重点从单个基因转移到模块.计算的两个关键步骤:1)计算基因间的相关性,2)将基因画为模块.</p>
<div id="计算基因的相关性" class="section level3" number="13.3.1">
<h3>
<span class="header-section-number">13.3.1</span> 计算基因的相关性<a class="anchor" aria-label="anchor" href="#%E8%AE%A1%E7%AE%97%E5%9F%BA%E5%9B%A0%E7%9A%84%E7%9B%B8%E5%85%B3%E6%80%A7"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>计算基因的两两间相关性</li>
</ol>
<p><span class="math display">\[S_{ij} = |cor(x_i,x_j)|\]</span></p>
<p>其中<span class="math inline">\(S_{ij}\)</span>是基因相关性矩阵.</p>
<ol start="2" style="list-style-type: decimal">
<li>无尺度化</li>
</ol>
<p>也就是对原始的相关性矩阵进行变换.构建相邻矩阵.为了知道两个基因表达是否类似,需要设定一个阈值(threshold),只有当基因之间的相关性大于该阈值,才认为他们之间是相似的,比如0.8.否则不相似,因此,相邻矩阵就是描述两个基因之间是否相似的矩阵.如果使用硬阈值,得到的相邻矩阵应该就是0,1矩阵.但是这种办法的缺点就在于怎么确定阈值?</p>
<p>在WGCNA中,使用的是软阈值的办法,软阈值的思路是通过加权函数,将相邻矩阵中的元素连续化:</p>
<p><span class="math display">\[a_{ij} = power(S_{ij}, \beta) = |S_{ij}|^\beta\]</span></p>
<p>在这里使用的是<code>power</code>函数.需要设置soft threshold,这时候需要确定power函数的参数β.如何选择合适的β呢?WGCNA的作者提供了两个标准:</p>
<ol style="list-style-type: decimal">
<li>网络更接近无尺度网络; 2) 尽可能保留连通性信息.</li>
</ol>
<p>β是WGCNA中第一个关键参数,后面在实际例子中进行详解.</p>
<ol start="3" style="list-style-type: decimal">
<li>基因间表达相关性</li>
</ol>
<p>上面我们得到了基因间的相邻矩阵,WGCNA为了更准确的表示两个基因间表达的相似性,还引入了另外一个概念,也就是TOM(Topological Overlap Matrix),拓扑重叠矩阵,她代表的是两个基因间相似性等于直接相关+间接相关.</p>
<p>计算公式如下:</p>
<p><span class="math display">\[TOM_{ij} = \frac{\displaystyle \sum_{u}{a_{iu}a_{uj}+a_{ij}}}{min(k_i,k_j)+1-a_{ij}}\]</span></p>
<p>其中<span class="math inline">\(\displaystyle \sum_{u}{a_{iu}a_{uj}}\)</span>代表基因i和j.</p>
<p><span class="math inline">\(a_{ij}\)</span>代表基因i和基因j的在相邻矩阵中的值.因此,上式中的分子代表的是基因i和j直接联系加上一阶(基因u)基因联系的和.</p>
<p>而<span class="math inline">\(k_i\)</span>代表基因k的degree,也就是基因k和其他所有直接连接的基因的关系之和.</p>
<p>TOM值的取值范围也是0-1.TOM值也就是WGCNA中最后的weight值.</p>
<ol start="4" style="list-style-type: decimal">
<li>聚类</li>
</ol>
<p>得到TOM值之后,也就得到了TOM矩阵.然后利用TOM矩阵,就可以对基因进行聚类了.WGCNA中使用的是层级聚类,聚类结束之后,就可以对分支进行剪切区分.得到module.</p>
<ol start="5" style="list-style-type: decimal">
<li>后续生物学意义挖掘</li>
</ol>
<p>得到模块之后,可以对模块进行生物学意义的挖掘.</p>
</div>
</div>
<div id="使用wgcna包进行分析" class="section level2" number="13.4">
<h2>
<span class="header-section-number">13.4</span> 使用WGCNA包进行分析<a class="anchor" aria-label="anchor" href="#%E4%BD%BF%E7%94%A8wgcna%E5%8C%85%E8%BF%9B%E8%A1%8C%E5%88%86%E6%9E%90"><i class="fas fa-link"></i></a>
</h2>
<div id="data-input-and-cleaning" class="section level3" number="13.4.1">
<h3>
<span class="header-section-number">13.4.1</span> Data input and cleaning<a class="anchor" aria-label="anchor" href="#data-input-and-cleaning"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>首先读取数据并清洗</li>
</ol>
<div class="sourceCode" id="cb190"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://horvath.genetics.ucla.edu/html/CoexpressionNetwork/Rpackages/WGCNA/">WGCNA</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">femData</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"WGCNA_test/LiverFemale3600.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">femData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">femData</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>可以看到该数据行是基因,列是样品.一共3600个基因.</p>
<p>然后将基因的描述列去掉.并且将其转置,得到的matrix行是样品,列是基因.</p>
<div class="sourceCode" id="cb191"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_exp0</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">femData</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data_exp0</span><span class="op">)</span> <span class="op">=</span> <span class="va">femData</span><span class="op">$</span><span class="va">substanceBXH</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">data_exp0</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">femData</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>然后需要去除掉数据(表达矩阵)中的outlier基因和样品.使用的是<code><a href="https://rdrr.io/pkg/WGCNA/man/goodSamplesGenes.html">goodSamplesGenes()</a></code>函数.</p>
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gsg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/goodSamplesGenes.html">goodSamplesGenes</a></span><span class="op">(</span><span class="va">data_exp0</span>, verbose <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">gsg</span><span class="op">$</span><span class="va">allOK</span></span></code></pre></div>
<p>该函数用来检查数据中的基因是否符合要求,返回结果是一个list.如果<code>allOK</code>为TRUE,则代表通过检查,如果不是TRUE,则需要手动去除基因和样品:</p>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">gsg</span><span class="op">$</span><span class="va">allOK</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Remove the offending genes and samples from the data:</span></span>
<span>  <span class="va">data_exp0</span> <span class="op">&lt;-</span> <span class="va">data_exp0</span><span class="op">[</span><span class="va">gsg</span><span class="op">$</span><span class="va">goodSamples</span>, <span class="va">gsg</span><span class="op">$</span><span class="va">goodGenes</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>我们可以使用数据对样品进行聚类,然后观察有哪些明显的outlier samples.</p>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampleTree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fastcluster/man/hclust.html">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">data_exp0</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"average"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">sampleTree</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Sample clustering to detect outliers"</span>,</span>
<span>  sub <span class="op">=</span> <span class="st">""</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">""</span>,</span>
<span>  cex.lab <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  cex.axis <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  cex.main <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>我们可以设定剪枝的阈值,比如我们设置为15,然后使用<code><a href="https://rdrr.io/pkg/WGCNA/man/cutreeStatic.html">cutreeStatic()</a></code>函数对样品进行分类.</p>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Determine cluster under the line</span></span>
<span><span class="va">clust</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/cutreeStatic.html">cutreeStatic</a></span><span class="op">(</span><span class="va">sampleTree</span>, cutHeight <span class="op">=</span> <span class="fl">15</span>, minSize <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">clust</span><span class="op">)</span></span></code></pre></div>
<p>可以明显的看到一个outlier sample(0).可以手动删除,也可以自动的办法.</p>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># clust 1 contains the samples we want to keep.</span></span>
<span><span class="va">keepSamples</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">clust</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">datExpr</span> <span class="op">=</span> <span class="va">data_exp0</span><span class="op">[</span><span class="va">keepSamples</span>,<span class="op">]</span></span>
<span><span class="va">nGenes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">datExpr</span><span class="op">)</span></span>
<span><span class="va">nSamples</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">datExpr</span><span class="op">)</span></span>
<span><span class="va">nGenes</span></span>
<span><span class="va">nSamples</span></span></code></pre></div>
<p><code>datExpr</code>就是我们最终用来进行network分析的表达数据.一共3600个基因,134个样品.</p>
<p>下面我们需要读取clinical data.后续需要使用clinical data和模块数据做分析.</p>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">traitData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"WGCNA_test/ClinicalTraits.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">traitData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">traitData</span><span class="op">)</span></span>
<span><span class="co"># remove columns that hold information we do not need.</span></span>
<span><span class="va">allTraits</span> <span class="op">=</span> <span class="va">traitData</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">31</span>, <span class="fl">16</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">allTraits</span> <span class="op">=</span> <span class="va">allTraits</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">11</span><span class="op">:</span><span class="fl">36</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">allTraits</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">allTraits</span><span class="op">)</span></span>
<span><span class="co"># Form a data frame analogous to expression data that will hold the clinical traits.</span></span>
<span><span class="va">femaleSamples</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">datExpr</span><span class="op">)</span></span>
<span><span class="va">traitRows</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">femaleSamples</span>, <span class="va">allTraits</span><span class="op">$</span><span class="va">Mice</span><span class="op">)</span></span>
<span><span class="va">datTraits</span> <span class="op">=</span> <span class="va">allTraits</span><span class="op">[</span><span class="va">traitRows</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">datTraits</span><span class="op">)</span> <span class="op">=</span> <span class="va">allTraits</span><span class="op">[</span><span class="va">traitRows</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/collectGarbage.html">collectGarbage</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>这时候我们得到的<code>datTraits</code>就是clinicaldata,其中行为样品,列为变量.</p>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">datTraits</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">datExpr</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>下面我们来看看样品的临床数据的热图和样品的基因的聚类.</p>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Re-cluster samples</span></span>
<span><span class="va">sampleTree2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fastcluster/man/hclust.html">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span><span class="op">(</span><span class="va">datExpr</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"average"</span><span class="op">)</span></span>
<span><span class="co"># Convert traits to a color representation: white means low, red means high, grey means missing entry</span></span>
<span><span class="va">traitColors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/numbers2colors.html">numbers2colors</a></span><span class="op">(</span><span class="va">datTraits</span>, signed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Plot the sample dendrogram and the colors underneath.</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/plotDendroAndColors.html">plotDendroAndColors</a></span><span class="op">(</span>dendro <span class="op">=</span> <span class="va">sampleTree2</span>,</span>
<span>                    colors <span class="op">=</span> <span class="va">traitColors</span>,</span>
<span>                    groupLabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">datTraits</span><span class="op">)</span>,</span>
<span>                    main <span class="op">=</span> <span class="st">"Sample dendrogram and trait heatmap"</span><span class="op">)</span></span></code></pre></div>
<p>最后,把数据保存下来,准备后续的分析.</p>
<div class="sourceCode" id="cb200"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">datExpr</span>, <span class="va">datTraits</span>, file <span class="op">=</span> <span class="st">"WGCNA_test/FemaleLiver-01-dataInput.RData"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="network-analysis-of-liver-expression-data-in-female-mice" class="section level3" number="13.4.2">
<h3>
<span class="header-section-number">13.4.2</span> Network analysis of liver expression data in female mice<a class="anchor" aria-label="anchor" href="#network-analysis-of-liver-expression-data-in-female-mice"><i class="fas fa-link"></i></a>
</h3>
<p>数据都准备好之后,下面就是做网络分析和module detection.</p>
<ol style="list-style-type: decimal">
<li>首先需要设置R运行环境,主要是要能够进行多线程处理,然后读取数据:</li>
</ol>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/allowWGCNAThreads.html">enableWGCNAThreads</a></span><span class="op">(</span>nThreads <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="co"># Load the data saved in the first part</span></span>
<span><span class="va">lnames</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"WGCNA_test/FemaleLiver-01-dataInput.RData"</span><span class="op">)</span></span>
<span><span class="co">#The variable lnames contains the names of loaded variables.</span></span>
<span><span class="va">lnames</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Automatic network construction and module detection</li>
</ol>
<p>WGCNA的第一个重要参数,就是构建相邻矩阵是的power函数的参数β.首先需要选择合适的<code>soft-thresholding power</code></p>
<p>在WGCNA中,使用<code><a href="https://rdrr.io/pkg/WGCNA/man/pickSoftThreshold.html">pickSoftThreshold()</a></code>函数.一般需要选择一系列candidate powers,然后根据结果进行选择.</p>
<blockquote>
<p>注意,这段代码在Rstudio中不能运行,运行出错,需要到R自带IDE或者终端中运行.</p>
</blockquote>
<div class="sourceCode" id="cb202"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Choose a set of soft-thresholding powers</span></span>
<span><span class="va">powers</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">12</span>, to <span class="op">=</span> <span class="fl">20</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Call the network topology analysis function</span></span>
<span><span class="va">sft</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/pickSoftThreshold.html">pickSoftThreshold</a></span><span class="op">(</span><span class="va">datExpr</span>, powerVector <span class="op">=</span> <span class="va">powers</span>, verbose <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">sft</span>, file <span class="op">=</span> <span class="st">"WGCNA_test/sft"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"WGCNA_test/sft"</span><span class="op">)</span></span>
<span><span class="va">powers</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">12</span>, to <span class="op">=</span> <span class="fl">20</span>, by <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Scale-free topology fit index as a function of the soft-thresholding power</span></span>
<span><span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Power</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html">sign</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span> <span class="op">*</span> <span class="va">SFT.R.sq</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.9</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, shape <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Power</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html">sign</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span> <span class="op">*</span> <span class="va">SFT.R.sq</span>, label <span class="op">=</span> <span class="va">Power</span><span class="op">)</span>,</span>
<span>                           color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Soft Threshold (power)"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Scale Free Topology Model Fit,signed R^2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>, </span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Mean connectivity as a function of the soft-thresholding power</span></span>
<span><span class="va">sft</span><span class="op">$</span><span class="va">fitIndices</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Power</span>, y <span class="op">=</span> <span class="va">mean.k.</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, shape <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Power</span>, y <span class="op">=</span> <span class="va">mean.k.</span>, label <span class="op">=</span> <span class="va">Power</span><span class="op">)</span>,</span>
<span>                           color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Soft Threshold (power)"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Mean Connectivity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>, </span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>左边图显示的是power和scale free topology fit的关系,右图显示的是power和mean connectivity的关系,一般选择能够使scale free topology fit达到最大时的最小的power.</p>
<p>这里我们选择6.</p>
<p>确定了power(β)参数之后,后面使用<code><a href="https://rdrr.io/pkg/WGCNA/man/blockwiseModules.html">blockwiseModules()</a></code>函数就可以得到modules.</p>
<div class="sourceCode" id="cb204"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">net</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/blockwiseModules.html">blockwiseModules</a></span><span class="op">(</span></span>
<span>  <span class="va">datExpr</span>,</span>
<span>  power <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  TOMType <span class="op">=</span> <span class="st">"unsigned"</span>,</span>
<span>  minModuleSize <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  reassignThreshold <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  mergeCutHeight <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>  numericLabels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  pamRespectsDendro <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  saveTOMs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  saveTOMFileBase <span class="op">=</span> <span class="st">"femaleMouseTOM"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><code>dataExpr</code>是基因表达数据,行是样品,列基因.</p>
<p>在这里我们选择了soft thresholding power 6, 然后最小module size设置为30.<code>mergeCutHeight</code>用来控制merge module.</p>
<p><code>maxBlockSize</code>: 是指最大的module的基因数量,默认为5000.</p>
<p><code>net</code>是最终的分类结果.</p>
<p>下面看一下分类结果.</p>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">net</span><span class="op">$</span><span class="va">colors</span><span class="op">)</span></span></code></pre></div>
<p>使用颜色来表示module,代表这里面有18个module.标记为0的基因代表没有归为任何一类module.</p>
<p>下面我们把module画出来.</p>
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert labels to colors for plotting</span></span>
<span><span class="va">mergedColors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/labels2colors.html">labels2colors</a></span><span class="op">(</span><span class="va">net</span><span class="op">$</span><span class="va">colors</span><span class="op">)</span></span>
<span><span class="co"># Plot the dendrogram and the module colors underneath</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/plotDendroAndColors.html">plotDendroAndColors</a></span><span class="op">(</span></span>
<span>  <span class="va">net</span><span class="op">$</span><span class="va">dendrograms</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">mergedColors</span><span class="op">[</span><span class="va">net</span><span class="op">$</span><span class="va">blockGenes</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="st">"Module colors"</span>,</span>
<span>  dendroLabels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  hang <span class="op">=</span> <span class="fl">0.03</span>,</span>
<span>  addGuide <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  guideHang <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>然后将结果保存,用于后续的分析.</p>
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">moduleLabels</span> <span class="op">=</span> <span class="va">net</span><span class="op">$</span><span class="va">colors</span></span>
<span><span class="va">moduleColors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/labels2colors.html">labels2colors</a></span><span class="op">(</span><span class="va">net</span><span class="op">$</span><span class="va">colors</span><span class="op">)</span></span>
<span><span class="va">MEs</span> <span class="op">=</span> <span class="va">net</span><span class="op">$</span><span class="va">MEs</span></span>
<span></span>
<span><span class="va">geneTree</span> <span class="op">=</span> <span class="va">net</span><span class="op">$</span><span class="va">dendrograms</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">MEs</span>, <span class="va">moduleLabels</span>, <span class="va">moduleColors</span>, <span class="va">geneTree</span>, <span class="va">net</span>,</span>
<span>     file <span class="op">=</span> <span class="st">"WGCNA_test/FemaleLiver-02-networkConstruction-auto.RData"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="relating-modules-to-external-information-and-identifying-important" class="section level3" number="13.4.3">
<h3>
<span class="header-section-number">13.4.3</span> Relating modules to external information and identifying important<a class="anchor" aria-label="anchor" href="#relating-modules-to-external-information-and-identifying-important"><i class="fas fa-link"></i></a>
</h3>
<p>首先加载上一步产生的数据:</p>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lnames</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"WGCNA_test/FemaleLiver-01-dataInput.RData"</span><span class="op">)</span>;</span>
<span><span class="co">#The variable lnames contains the names of loaded variables.</span></span>
<span><span class="va">lnames</span></span>
<span><span class="co"># Load network data saved in the second part.</span></span>
<span><span class="va">lnames</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"WGCNA_test/FemaleLiver-02-networkConstruction-auto.RData"</span><span class="op">)</span>;</span>
<span><span class="va">lnames</span></span></code></pre></div>
<p>然后我们想要找到和clinical data关系非常紧密的module.对于每个module的来说,都有一个eigengene,也就是其PCA分析的第一主成分,用来代表该module在每个样品中的含量.</p>
<p>这个矩阵除了可以从最终的结果<code>net</code>中直接得到,还可以使用下面的函数<code>moduleEigengenes</code>得到.</p>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Recalculate MEs with color labels</span></span>
<span><span class="va">MEs0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/moduleEigengenes.html">moduleEigengenes</a></span><span class="op">(</span>expr <span class="op">=</span> <span class="va">datExpr</span>, colors <span class="op">=</span> <span class="va">moduleColors</span><span class="op">)</span><span class="op">$</span><span class="va">eigengenes</span></span>
<span><span class="va">MEs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/orderMEs.html">orderMEs</a></span><span class="op">(</span><span class="va">MEs0</span><span class="op">)</span></span></code></pre></div>
<p>我们也可以把这个数据和从<code>net</code>中直接得到的对比看一下.</p>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">net</span><span class="op">$</span><span class="va">MEs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">MEs</span><span class="op">)</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">moduleColors</span>, <span class="va">net</span><span class="op">$</span><span class="va">colors</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>然后我们使用<code>WGCNA</code>中的<code>cor</code>函数计算module和clinical data的相关性.</p>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define numbers of genes and samples</span></span>
<span><span class="va">nGenes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">datExpr</span><span class="op">)</span></span>
<span><span class="va">nSamples</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">datExpr</span><span class="op">)</span></span>
<span><span class="va">moduleTraitCor</span> <span class="op">=</span> <span class="fu">WGCNA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/cor.html">cor</a></span><span class="op">(</span><span class="va">MEs</span>, <span class="va">datTraits</span>, use <span class="op">=</span> <span class="st">"p"</span><span class="op">)</span></span>
<span><span class="va">moduleTraitPvalue</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/corPvalueStudent.html">corPvalueStudent</a></span><span class="op">(</span><span class="va">moduleTraitCor</span>, <span class="va">nSamples</span><span class="op">)</span></span></code></pre></div>
<p>下面对correlation进行可视化:</p>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Will display correlations and their p-values</span></span>
<span><span class="va">textMatrix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">moduleTraitCor</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n("</span>,</span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">moduleTraitPvalue</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">")"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">textMatrix</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">moduleTraitCor</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">8.5</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Display the correlation values within a heatmap plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/labeledHeatmap.html">labeledHeatmap</a></span><span class="op">(</span>Matrix <span class="op">=</span> <span class="va">moduleTraitCor</span>,</span>
<span>xLabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">datTraits</span><span class="op">)</span>,</span>
<span>yLabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">MEs</span><span class="op">)</span>,</span>
<span>ySymbols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">MEs</span><span class="op">)</span>,</span>
<span>colorLabels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/greenWhiteRed.html">greenWhiteRed</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span>,</span>
<span><span class="co"># textMatrix = textMatrix,</span></span>
<span>setStdMargins <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>cex.text <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Module-trait relationships"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>从上图中可以看出<code>weight_g</code>跟一些module相关性非常强.</p>
<p>Gene relationship to trait and important modules: Gene Significance and Module Membership</p>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define variable weight containing the weight column of datTrait</span></span>
<span><span class="va">weight</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">datTraits</span><span class="op">$</span><span class="va">weight_g</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span> <span class="op">=</span> <span class="st">"weight"</span></span>
<span><span class="co"># names (colors) of the modules</span></span>
<span><span class="va">modNames</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">MEs</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">##计算每个基因和module的相关性</span></span>
<span><span class="va">geneModuleMembership</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu">WGCNA</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/cor.html">cor</a></span><span class="op">(</span><span class="va">datExpr</span>, <span class="va">MEs</span>, use <span class="op">=</span> <span class="st">"p"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">MMPvalue</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/corPvalueStudent.html">corPvalueStudent</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">geneModuleMembership</span><span class="op">)</span>, <span class="va">nSamples</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">geneModuleMembership</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"MM"</span>, <span class="va">modNames</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">MMPvalue</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p.MM"</span>, <span class="va">modNames</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">##计算基因和weight的相关性</span></span>
<span><span class="va">geneTraitSignificance</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/cor.html">cor</a></span><span class="op">(</span><span class="va">datExpr</span>, <span class="va">weight</span>, use <span class="op">=</span> <span class="st">"p"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">GSPvalue</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/corPvalueStudent.html">corPvalueStudent</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">geneTraitSignificance</span><span class="op">)</span>, <span class="va">nSamples</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">geneTraitSignificance</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"GS."</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">GSPvalue</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p.GS."</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p>Intramodular analysis: identifying genes with high GS and MM</p>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">module</span> <span class="op">=</span> <span class="st">"brown"</span></span>
<span><span class="va">column</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">module</span>, <span class="va">modNames</span><span class="op">)</span></span>
<span><span class="va">moduleGenes</span> <span class="op">=</span> <span class="va">moduleColors</span><span class="op">==</span><span class="va">module</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/verboseScatterplot.html">verboseScatterplot</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">geneModuleMembership</span><span class="op">[</span><span class="va">moduleGenes</span>, <span class="va">column</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">geneTraitSignificance</span><span class="op">[</span><span class="va">moduleGenes</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Module Membership in"</span>, <span class="va">module</span>, <span class="st">"module"</span><span class="op">)</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Gene significance for body weight"</span>,</span>
<span>  main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Module membership vs. gene significance\n"</span><span class="op">)</span>,</span>
<span>  cex.main <span class="op">=</span> <span class="fl">1.2</span>,</span>
<span>  cex.lab <span class="op">=</span> <span class="fl">1.2</span>,</span>
<span>  cex.axis <span class="op">=</span> <span class="fl">1.2</span>,</span>
<span>  col <span class="op">=</span> <span class="va">module</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Summary output of network analysis results</p>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">datExpr</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">datExpr</span><span class="op">)</span><span class="op">[</span><span class="va">moduleColors</span><span class="op">==</span><span class="st">"brown"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">annot</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"WGCNA_test/GeneAnnotation.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">annot</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">annot</span><span class="op">)</span></span>
<span><span class="va">probes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">datExpr</span><span class="op">)</span></span>
<span><span class="va">probes2annot</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">probes</span>, <span class="va">annot</span><span class="op">$</span><span class="va">substanceBXH</span><span class="op">)</span></span>
<span><span class="co"># The following is the number or probes without annotation:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">probes2annot</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb217"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create the starting data frame</span></span>
<span><span class="va">geneInfo0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>substanceBXH <span class="op">=</span> <span class="va">probes</span>,</span>
<span>geneSymbol <span class="op">=</span> <span class="va">annot</span><span class="op">$</span><span class="va">gene_symbol</span><span class="op">[</span><span class="va">probes2annot</span><span class="op">]</span>,</span>
<span>LocusLinkID <span class="op">=</span> <span class="va">annot</span><span class="op">$</span><span class="va">LocusLinkID</span><span class="op">[</span><span class="va">probes2annot</span><span class="op">]</span>,</span>
<span>moduleColor <span class="op">=</span> <span class="va">moduleColors</span>,</span>
<span><span class="va">geneTraitSignificance</span>,</span>
<span><span class="va">GSPvalue</span><span class="op">)</span></span>
<span><span class="co"># Order modules by their significance for weight</span></span>
<span><span class="va">modOrder</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/WGCNA/man/cor.html">cor</a></span><span class="op">(</span><span class="va">MEs</span>, <span class="va">weight</span>, use <span class="op">=</span> <span class="st">"p"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>;</span>
<span><span class="co"># Add module membership information in the chosen order</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">mod</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">geneModuleMembership</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span><span class="va">oldNames</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">geneInfo0</span><span class="op">)</span></span>
<span><span class="va">geneInfo0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">geneInfo0</span>, <span class="va">geneModuleMembership</span><span class="op">[</span>, <span class="va">modOrder</span><span class="op">[</span><span class="va">mod</span><span class="op">]</span><span class="op">]</span>,</span>
<span><span class="va">MMPvalue</span><span class="op">[</span>, <span class="va">modOrder</span><span class="op">[</span><span class="va">mod</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>;</span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">geneInfo0</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">oldNames</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"MM."</span>, <span class="va">modNames</span><span class="op">[</span><span class="va">modOrder</span><span class="op">[</span><span class="va">mod</span><span class="op">]</span><span class="op">]</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,</span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"p.MM."</span>, <span class="va">modNames</span><span class="op">[</span><span class="va">modOrder</span><span class="op">[</span><span class="va">mod</span><span class="op">]</span><span class="op">]</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Order the genes in the geneInfo variable first by module color, then by geneTraitSignificance</span></span>
<span><span class="va">geneOrder</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">geneInfo0</span><span class="op">$</span><span class="va">moduleColor</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">geneInfo0</span><span class="op">$</span><span class="va">GS.weight</span><span class="op">)</span><span class="op">)</span>;</span>
<span><span class="va">geneInfo</span> <span class="op">=</span> <span class="va">geneInfo0</span><span class="op">[</span><span class="va">geneOrder</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">geneInfo</span>, file <span class="op">=</span> <span class="st">"WGCNA_test/geneInfo.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="对module进行分析" class="section level3" number="13.4.4">
<h3>
<span class="header-section-number">13.4.4</span> 对module进行分析<a class="anchor" aria-label="anchor" href="#%E5%AF%B9module%E8%BF%9B%E8%A1%8C%E5%88%86%E6%9E%90"><i class="fas fa-link"></i></a>
</h3>
<p>在前文中,鉴定出了几个和weight相关的module.</p>
<p>一般需要进行GO注释或者KEGG pathway分析.</p>
<hr>
<div id="disqus_thread">

</div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://r-cookbook-shen.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script><noscript>
Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="regularexpression.html"><span class="header-section-number">12</span> 正则表达式</a></div>
<div class="next"><a href="biostatistics.html"><span class="header-section-number">14</span> Modern Statistics for Modern Biology</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#multiomics"><span class="header-section-number">13</span> 多组学分析</a></li>
<li><a class="nav-link" href="#wgcna"><span class="header-section-number">13.1</span> WGCNA</a></li>
<li>
<a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="header-section-number">13.2</span> 基础概念</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E6%97%A0%E5%B0%BA%E5%BA%A6%E7%BD%91%E7%BB%9Cscale-free-network"><span class="header-section-number">13.2.1</span> 无尺度网络(scale free network)</a></li>
<li><a class="nav-link" href="#%E6%A8%A1%E5%9D%97module%E5%92%8C%E6%A8%A1%E5%9D%97%E7%89%B9%E5%BE%81%E5%80%BC"><span class="header-section-number">13.2.2</span> 模块(module)和模块特征值</a></li>
<li><a class="nav-link" href="#%E8%BF%9E%E9%80%9A%E6%80%A7-connectivity"><span class="header-section-number">13.2.3</span> 连通性 (Connectivity)</a></li>
<li><a class="nav-link" href="#hub-gene"><span class="header-section-number">13.2.4</span> Hub gene</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#wgcna-%E4%BB%8B%E7%BB%8D"><span class="header-section-number">13.3</span> WGCNA 介绍</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E5%9F%BA%E5%9B%A0%E7%9A%84%E7%9B%B8%E5%85%B3%E6%80%A7"><span class="header-section-number">13.3.1</span> 计算基因的相关性</a></li></ul>
</li>
<li>
<a class="nav-link" href="#%E4%BD%BF%E7%94%A8wgcna%E5%8C%85%E8%BF%9B%E8%A1%8C%E5%88%86%E6%9E%90"><span class="header-section-number">13.4</span> 使用WGCNA包进行分析</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-input-and-cleaning"><span class="header-section-number">13.4.1</span> Data input and cleaning</a></li>
<li><a class="nav-link" href="#network-analysis-of-liver-expression-data-in-female-mice"><span class="header-section-number">13.4.2</span> Network analysis of liver expression data in female mice</a></li>
<li><a class="nav-link" href="#relating-modules-to-external-information-and-identifying-important"><span class="header-section-number">13.4.3</span> Relating modules to external information and identifying important</a></li>
<li><a class="nav-link" href="#%E5%AF%B9module%E8%BF%9B%E8%A1%8C%E5%88%86%E6%9E%90"><span class="header-section-number">13.4.4</span> 对module进行分析</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/jaspershen/r4bioinformatics/blob/main/12-multiomics.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/jaspershen/r4bioinformatics/edit/main/12-multiomics.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R for Bioinformatics project</strong>" was written by Xiaotao Shen. It was last built on 2020-8-30 and updated on 2024-01-30.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
